{% extends "base.html" %}

{% block title %}Admin - Settings{% endblock %}

{% block content %}
<div class="container my-5 admin-settings-container">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="display-5 fw-bold">
                <i class="fas fa-cog me-3"></i>
                Company Settings
            </h1>
            <p class="lead text-muted">Manage your company information and website settings</p>
        </div>
    </div>

    <form method="POST">
        <div class="row g-4">
            <!-- Company Information -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-building me-2"></i>
                            Company Information
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="company_name_en" class="form-label">Company Name (English) *</label>
                                <input type="text" class="form-control" id="company_name_en" name="company_name_en" 
                                       value="{{ settings.company_name_en }}" required>
                            </div>
                            <div class="col-md-6">
                                <label for="company_name_id" class="form-label">Company Name (Indonesian) *</label>
                                <input type="text" class="form-control" id="company_name_id" name="company_name_id" 
                                       value="{{ settings.company_name_id }}" required>
                            </div>
                            <div class="col-12">
                                <label for="company_description_en" class="form-label">Company Description (English)</label>
                                <textarea class="form-control" id="company_description_en" name="company_description_en" 
                                          rows="3">{{ settings.company_description_en }}</textarea>
                            </div>
                            <div class="col-12">
                                <label for="company_description_id" class="form-label">Company Description (Indonesian)</label>
                                <textarea class="form-control" id="company_description_id" name="company_description_id" 
                                          rows="3">{{ settings.company_description_id }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact Information -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-address-book me-2"></i>
                            Contact Information
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="contact_email" class="form-label">Email Address *</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                    <input type="email" class="form-control" id="contact_email" name="contact_email" 
                                           value="{{ settings.contact_email }}" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="contact_phone" class="form-label">Phone Number</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                    <input type="tel" class="form-control" id="contact_phone" name="contact_phone" 
                                           value="{{ settings.contact_phone }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label for="contact_whatsapp" class="form-label">WhatsApp Number</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fab fa-whatsapp"></i></span>
                                    <input type="tel" class="form-control" id="contact_whatsapp" name="contact_whatsapp" 
                                           value="{{ settings.contact_whatsapp }}" 
                                           placeholder="+62-812-3456-7890">
                                </div>
                                <div class="form-text">Include country code (e.g., +62-812-3456-7890)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Address Information -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0">
                            <i class="fas fa-map-marker-alt me-2"></i>
                            Address Information
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="address_en" class="form-label">Address (English)</label>
                                <textarea class="form-control" id="address_en" name="address_en" 
                                          rows="3">{{ settings.address_en }}</textarea>
                            </div>
                            <div class="col-md-6">
                                <label for="address_id" class="form-label">Address (Indonesian)</label>
                                <textarea class="form-control" id="address_id" name="address_id" 
                                          rows="3">{{ settings.address_id }}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appearance Settings -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header" style="background: linear-gradient(45deg, #17a2b8, #6f42c1); color: white;">
                        <h5 class="mb-0">
                            <i class="fas fa-palette me-2"></i>
                            Appearance Settings
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row mb-4">
                            <div class="col-12">
                                <label class="form-label">Theme Mode</label>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-check theme-preview border rounded p-3 cursor-pointer {{ 'border-primary' if not settings.theme_mode or settings.theme_mode == 'preset' }}">
                                            <input class="form-check-input" type="radio" name="theme_mode" id="theme_preset" 
                                                   value="preset" {{ 'checked' if not settings.theme_mode or settings.theme_mode == 'preset' }}>
                                            <label class="form-label" for="theme_preset">
                                                <strong>Preset Themes</strong>
                                            </label>
                                            <div class="form-text">Choose from predefined themes.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check theme-preview border rounded p-3 cursor-pointer {{ 'border-primary' if settings.theme_mode == 'custom' }}">
                                            <input class="form-check-input" type="radio" name="theme_mode" id="theme_custom" 
                                                   value="custom" {{ 'checked' if settings.theme_mode == 'custom' }}>
                                            <label class="form-label" for="theme_custom">
                                                <strong>Custom Theme</strong>
                                            </label>
                                            <div class="form-text">Define your own color scheme.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Preset Themes -->
                        <div id="preset-themes" style="{{ 'display: none;' if settings.theme_mode == 'custom' }}">
                            <div class="row g-3 mb-4">
                                <div class="col-md-4">
                                    <div class="theme-preview border rounded p-3 cursor-pointer {{ 'border-primary' if settings.selected_theme == 'theme1' }}">
                                        <input type="radio" name="selected_theme" id="theme1" value="theme1" 
                                               {{ 'checked' if not settings.selected_theme or settings.selected_theme == 'theme1' }}>
                                        <label class="form-label" for="theme1"><strong>Theme 1</strong></label>
                                        <img src="{{ url_for('static', filename='images/theme1_preview.png') }}" class="img-fluid rounded mt-2" alt="Theme 1 Preview">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="theme-preview border rounded p-3 cursor-pointer {{ 'border-primary' if settings.selected_theme == 'theme2' }}">
                                        <input type="radio" name="selected_theme" id="theme2" value="theme2" 
                                               {{ 'checked' if settings.selected_theme == 'theme2' }}>
                                        <label class="form-label" for="theme2"><strong>Theme 2 - Gallery Background</strong></label>
                                        <img src="{{ url_for('static', filename='images/theme2_preview.png') }}" class="img-fluid rounded mt-2" alt="Theme 2 Preview">
                                        <div class="form-text mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-info-circle me-1"></i>
                                                Uses gallery images as navbar background for better visibility
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="theme-preview border rounded p-3 cursor-pointer {{ 'border-primary' if settings.selected_theme == 'quality_care' }}">
                                        <input type="radio" name="selected_theme" id="quality_care" value="quality_care" 
                                               {{ 'checked' if settings.selected_theme == 'quality_care' }}>
                                        <label class="form-label" for="quality_care"><strong>Theme 3 - Quality Care</strong></label>
                                        <div class="mt-2 p-3 rounded" style="background: linear-gradient(rgba(39, 174, 96, 0.85), rgba(34, 153, 84, 0.85)), url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80') center/cover; height: 120px; border-radius: 8px;">
                                            <div class="text-white text-center h-100 d-flex align-items-center justify-content-center">
                                                <div>
                                                    <i class="fas fa-leaf fa-2x mb-2"></i>
                                                    <div><small><strong>Beautiful Landscape</strong></small></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-text mt-2">
                                            <small class="text-muted">
                                                <i class="fas fa-mountain me-1"></i>
                                                Premium landscape background with green nature overlay
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Preset Mode:</strong> Select one of the predefined themes to apply a consistent look and feel across your website.
                                </div>
                            </div>
                        </div>

                        <!-- Custom Colors -->
                        <div id="custom-colors" style="{{ 'display: none;' if not settings.theme_mode or settings.theme_mode == 'preset' }}">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label for="custom_primary_color" class="form-label">Primary Color</label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="custom_primary_color" name="custom_primary_color" 
                                               value="{{ settings.custom_primary_color or '#007bff' }}" title="Choose primary color">
                                        <input type="text" class="form-control" id="custom_primary_color_text" value="{{ settings.custom_primary_color or '#007bff' }}" readonly>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="custom_secondary_color" class="form-label">Secondary Color</label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="custom_secondary_color" name="custom_secondary_color" 
                                               value="{{ settings.custom_secondary_color or '#6c757d' }}" title="Choose secondary color">
                                        <input type="text" class="form-control" value="{{ settings.custom_secondary_color or '#6c757d' }}" readonly>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="custom_accent_color" class="form-label">Accent Color</label>
                                    <div class="input-group">
                                        <input type="color" class="form-control form-control-color" id="custom_accent_color" name="custom_accent_color" 
                                               value="{{ settings.custom_accent_color or '#17a2b8' }}" title="Choose accent color">
                                        <input type="text" class="form-control" value="{{ settings.custom_accent_color or '#17a2b8' }}" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Custom Mode:</strong> Create your own unique color scheme. Primary color is used for navigation and buttons, secondary for text and backgrounds, accent for highlights.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logo Settings -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-image me-2"></i>
                            Logo Settings
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label for="logo_url" class="form-label">Company Logo</label>
                                <div class="input-group">
                                    <input type="file" class="form-control" id="logo_file" name="logo_file" accept="image/*">
                                    <input type="url" class="form-control" id="logo_url" name="logo_url" 
                                           placeholder="Or enter image URL" value="{{ settings.logo_url }}">
                                </div>
                                <div class="form-text">Upload a new logo or enter an image URL. Recommended size: 200x60 pixels</div>
                            </div>
                            <div class="col-md-4">
                                {% if settings.logo_url %}
                                <label class="form-label">Current Logo</label>
                                <div>
                                    <img src="{{ settings.logo_url }}" alt="Current Logo" class="img-thumbnail" style="max-height: 80px;">
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Company Gallery -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-images me-2"></i>
                            Company Gallery
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Gallery Display Mode</label>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-check theme-preview border rounded p-3 cursor-pointer {{ 'border-primary' if not settings.gallery_mode or settings.gallery_mode == 'static' }}" onclick="selectGalleryMode('static')">
                                            <input class="form-check-input" type="radio" name="gallery_mode" id="gallery_static" 
                                                   value="static" {{ 'checked' if not settings.gallery_mode or settings.gallery_mode == 'static' }}>
                                            <label class="form-label" for="gallery_static" style="cursor: pointer;">
                                                <strong>Static Image</strong>
                                            </label>
                                            <div class="form-text">Display a single hero image in background</div>
                                            <div class="mt-2">
                                                <div class="bg-light p-3 rounded text-center">
                                                    <i class="fas fa-image fa-2x text-muted"></i>
                                                    <div class="mt-2"><small>Single Background Image</small></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check theme-preview border rounded p-3 cursor-pointer {{ 'border-primary' if settings.gallery_mode == 'carousel' }}" onclick="selectGalleryMode('carousel')">
                                            <input class="form-check-input" type="radio" name="gallery_mode" id="gallery_carousel" 
                                                   value="carousel" {{ 'checked' if settings.gallery_mode == 'carousel' }}>
                                            <label class="form-label" for="gallery_carousel" style="cursor: pointer;">
                                                <strong>Image Carousel</strong>
                                            </label>
                                            <div class="form-text">Interactive slideshow with up to 5 images</div>
                                            <div class="mt-2">
                                                <div class="bg-light p-3 rounded text-center">
                                                    <i class="fas fa-images fa-2x text-muted"></i>
                                                    <div class="mt-2"><small>Multiple Images Slideshow</small></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row g-3 mt-3">
                            <div class="col-12">
                                <label for="gallery_files" class="form-label">Gallery Images</label>
                                <input type="file" class="form-control" id="gallery_files" name="gallery_files" 
                                       accept="image/*" multiple>
                                <div class="form-text">Upload multiple PNG, JPG, GIF, or WEBP images (max 5MB each). You can upload up to 5 images.</div>

                                <!-- Current Gallery Images -->
                                {% if settings.gallery_images %}
                                <div class="mt-3">
                                    <h6>Current Gallery Images:</h6>
                                    <div class="row g-2">
                                        {% set gallery_list = settings.gallery_images.split(',') if settings.gallery_images else [] %}
                                        {% for image_url in gallery_list[:5] %}
                                        {% if image_url.strip() %}
                                        <div class="col-md-3">
                                            <div class="card position-relative">
                                                <img src="{{ image_url.strip() }}" class="card-img-top" alt="Gallery Image" style="height: 120px; object-fit: cover;">
                                                <div class="card-body p-2">
                                                    <small class="text-muted">Image {{ loop.index }}/5</small>
                                                    <button type="button" class="btn btn-danger btn-sm w-100 mt-1" 
                                                            onclick="deleteGalleryImage('{{ image_url.strip() }}')">
                                                        <i class="fas fa-trash"></i> Delete
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Gallery Preview -->
                        <div class="row g-3 mt-3">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Gallery Usage
                                    </h6>
                                    <div id="gallery-usage-static" style="{{ 'display: none;' if settings.gallery_mode == 'carousel' }}">
                                        <p class="mb-0"><strong>Static Mode:</strong> First gallery image will be used as hero background image across the website for themes that support landscape backgrounds (Theme 1 & 2).</p>
                                    </div>
                                    <div id="gallery-usage-carousel" style="{{ 'display: none;' if not settings.gallery_mode or settings.gallery_mode == 'static' }}">
                                        <p class="mb-0"><strong>Carousel Mode:</strong> Gallery images will be displayed as an interactive slideshow in the "Company Documentation" section when Carousel Layout is selected.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Layout Settings -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header" style="background: linear-gradient(45deg, #17a2b8, #6f42c1); color: white;">
                        <h5 class="mb-0">
                            <i class="fas fa-layout me-2"></i>
                            Layout Settings
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Homepage Layout</label>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="layout_type" id="layout_standard" 
                                                   value="standard" {{ 'checked' if not settings.layout_type or settings.layout_type == 'standard' }}>
                                            <label class="form-label" for="layout_standard">
                                                <strong>Standard Layout (Current)</strong>
                                                <div class="form-text">Clean layout without carousel - current design</div>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="layout_type" id="layout_carousel" 
                                                   value="carousel" {{ 'checked' if settings.layout_type == 'carousel' }}>
                                            <label class="form-label" for="layout_carousel">
                                                <strong>Carousel Layout</strong>
                                                <div class="form-text">Interactive layout with product carousel and company documentation</div>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Layout Preview -->
                                <div class="mt-4">
                                    <div class="alert alert-info">
                                        <h6 class="alert-heading">
                                            <i class="fas fa-eye me-2"></i>
                                            Layout Preview
                                        </h6>
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <div class="bg-light p-3 rounded text-center">
                                                    <strong>Standard Layout</strong><br>
                                                    <small class="text-muted">
                                                        Hero Section → Features → Categories → Products → Contact
                                                    </small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="bg-light p-3 rounded text-center">
                                                    <strong>Carousel Layout</strong><br>
                                                    <small class="text-muted">
                                                        Hero → Product Carousel → Company Docs → Features → Contact
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Website Footer Settings -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-copyright me-2"></i>
                            Website Footer & Copyright
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="copyright_text" class="form-label">Copyright Text</label>
                                <input type="text" class="form-control" id="copyright_text" name="copyright_text" 
                                       value="{{ settings.copyright_text }}" 
                                       placeholder="© 2024 Website by Fajar Julyana. All rights reserved.">
                                <div class="form-text">This will appear in the website footer</div>
                            </div>
                        </div>

                        <!-- Copyright Preview -->
                        <div class="row g-3 mt-3">
                            <div class="col-12">
                                <div class="alert alert-light border">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-eye me-2"></i>
                                        Footer Preview
                                    </h6>
                                    <div class="bg-dark text-white p-3 rounded text-center">
                                        <small id="copyright_preview">{{ settings.copyright_text }}</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Preview -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-eye me-2"></i>
                            Website Preview
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="alert alert-info">
                            <h6 class="alert-heading">
                                <i class="fas fa-info-circle me-2"></i>
                                How it appears on your website
                            </h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <strong>English Version:</strong><br>
                                    <div class="bg-light p-3 rounded mt-2">
                                        <h6 id="preview_company_en" class="fw-bold">{{ settings.company_name_en }}</h6>
                                        <p id="preview_description_en" class="mb-2">{{ settings.company_description_en }}</p>
                                        <small class="text-muted">
                                            <i class="fas fa-envelope me-1"></i><span id="preview_email_en">{{ settings.contact_email }}</span><br>
                                            <i class="fas fa-phone me-1"></i><span id="preview_phone_en">{{ settings.contact_phone }}</span><br>
                                            <i class="fas fa-map-marker-alt me-1"></i><span id="preview_address_en">{{ settings.address_en }}</span>
                                        </small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <strong>Indonesian Version:</strong><br>
                                    <div class="bg-light p-3 rounded mt-2">
                                        <h6 id="preview_company_id" class="fw-bold">{{ settings.company_name_id }}</h6>
                                        <p id="preview_description_id" class="mb-2">{{ settings.company_description_id }}</p>
                                        <small class="text-muted">
                                            <i class="fas fa-envelope me-1"></i><span id="preview_email_id">{{ settings.contact_email }}</span><br>
                                            <i class="fas fa-phone me-1"></i><span id="preview_phone_id">{{ settings.contact_phone }}</span><br>
                                            <i class="fas fa-map-marker-alt me-1"></i><span id="preview_address_id">{{ settings.address_id }}</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Changes will be visible on your website immediately after saving.
                                </small>
                            </div>
                            <div>
                                <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary me-2">
                                    <i class="fas fa-arrow-left me-2"></i>
                                    Back to Dashboard
                                </a>
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="fas fa-save me-2"></i>
                                    Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
// Live preview updates
function updatePreview() {
    // English previews
    document.getElementById('preview_company_en').textContent = 
        document.getElementById('company_name_en').value || 'Company Name';
    document.getElementById('preview_description_en').textContent = 
        document.getElementById('company_description_en').value || 'Company description...';
    document.getElementById('preview_email_en').textContent = 
        document.getElementById('contact_email').value || 'email@example.com';
    document.getElementById('preview_phone_en').textContent = 
        document.getElementById('contact_phone').value || 'Phone number';
    document.getElementById('preview_address_en').textContent = 
        document.getElementById('address_en').value || 'Company address';

    // Indonesian previews
    document.getElementById('preview_company_id').textContent = 
        document.getElementById('company_name_id').value || 'Nama Perusahaan';
    document.getElementById('preview_description_id').textContent = 
        document.getElementById('company_description_id').value || 'Deskripsi perusahaan...';
    document.getElementById('preview_email_id').textContent = 
        document.getElementById('contact_email').value || 'email@example.com';
    document.getElementById('preview_phone_id').textContent = 
        document.getElementById('contact_phone').value || 'Nomor telepon';
    document.getElementById('preview_address_id').textContent = 
        document.getElementById('address_id').value || 'Alamat perusahaan';
}

// Add event listeners to all form inputs
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('input, textarea');
    inputs.forEach(input => {
        input.addEventListener('input', updatePreview);
    });

    // Color picker event listeners
    const primaryColorPicker = document.getElementById('primary_color');
    const secondaryColorPicker = document.getElementById('secondary_color');
    const primaryColorText = document.getElementById('primary_color_text');
    const secondaryColorText = document.getElementById('secondary_color_text');
    const primaryPreview = document.getElementById('primary_preview');
    const secondaryPreview = document.getElementById('secondary_preview');

    primaryColorPicker.addEventListener('input', function() {
        primaryColorText.value = this.value;
        primaryPreview.style.backgroundColor = this.value;
    });

    secondaryColorPicker.addEventListener('input', function() {
        secondaryColorText.value = this.value;
        secondaryPreview.style.backgroundColor = this.value;
    });

    // Copyright preview
    const copyrightInput = document.getElementById('copyright_text');
    const copyrightPreview = document.getElementById('copyright_preview');

    copyrightInput.addEventListener('input', function() {
        copyrightPreview.textContent = this.value || '© 2024 Website by Fajar Julyana. All rights reserved.';
    });
});

// Gallery image removal function
function removeGalleryImage(imageUrl) {
    if (confirm('Are you sure you want to remove this gallery image?')) {
        // Create a hidden form to submit the removal
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("admin.remove_gallery_image") }}';

        const csrfToken = document.querySelector('input[name="csrf_token"]');
        if (csrfToken) {
            const hiddenCsrf = document.createElement('input');
            hiddenCsrf.type = 'hidden';
            hiddenCsrf.name = 'csrf_token';
            hiddenCsrf.value = csrfToken.value;
            form.appendChild(hiddenCsrf);
        }

        const hiddenImageUrl = document.createElement('input');
        hiddenImageUrl.type = 'hidden';
        hiddenImageUrl.name = 'image_url';
        hiddenImageUrl.value = imageUrl;
        form.appendChild(hiddenImageUrl);

        document.body.appendChild(form);
        form.submit();
    }
}

// Gallery image deletion function
function deleteGalleryImage(imageUrl) {
    if (confirm('Are you sure you want to delete this gallery image? This action cannot be undone.')) {
        // Create a hidden form to submit the deletion
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '{{ url_for("admin.remove_gallery_image") }}';

        const csrfToken = document.querySelector('input[name="csrf_token"]');
        if (csrfToken) {
            const hiddenCsrf = document.createElement('input');
            hiddenCsrf.type = 'hidden';
            hiddenCsrf.name = 'csrf_token';
            hiddenCsrf.value = csrfToken.value;
            form.appendChild(hiddenCsrf);
        }

        const hiddenImageUrl = document.createElement('input');
        hiddenImageUrl.type = 'hidden';
        hiddenImageUrl.name = 'image_url';
        hiddenImageUrl.value = imageUrl;
        form.appendChild(hiddenImageUrl);

        document.body.appendChild(form);
        form.submit();
    }
}

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const requiredFields = ['company_name_en', 'company_name_id', 'contact_email'];
    let isValid = true;

    requiredFields.forEach(fieldName => {
        const field = document.getElementById(fieldName);
        if (!field.value.trim()) {
            field.classList.add('is-invalid');
            isValid = false;
        } else {
            field.classList.remove('is-invalid');
        }
    });

    if (!isValid) {
        e.preventDefault();
        alert('Please fill in all required fields');
    }
});

// Theme mode toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    const presetRadio = document.getElementById('theme_preset');
    const customRadio = document.getElementById('theme_custom');
    const presetThemes = document.getElementById('preset-themes');
    const customColors = document.getElementById('custom-colors');

    function toggleThemeMode() {
        if (presetRadio.checked) {
            presetThemes.style.display = 'block';
            customColors.style.display = 'none';
        } else {
            presetThemes.style.display = 'none';
            customColors.style.display = 'block';
        }
    }

    presetRadio.addEventListener('change', toggleThemeMode);
    customRadio.addEventListener('change', toggleThemeMode);

    // Initial state
    toggleThemeMode();

    // Theme card click functionality
    document.querySelectorAll('.theme-preview').forEach(card => {
        card.addEventListener('click', function() {
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;

            // Remove active class from all cards
            document.querySelectorAll('.theme-preview').forEach(c => {
                c.classList.remove('border-primary');
            });

            // Add active class to clicked card
            this.classList.add('border-primary');
        });
    });

    // Color picker synchronization
    function syncColorPicker(colorId, textId) {
        const colorInput = document.getElementById(colorId);
        const textInput = document.getElementById(textId);

        if (colorInput && textInput) {
            colorInput.addEventListener('change', function() {
                textInput.value = this.value;
            });
        }
    }

    // Sync color pickers with text inputs
    syncColorPicker('custom_primary_color', 'custom_primary_color_text');
    syncColorPicker('custom_secondary_color', 'custom_secondary_color_text');
    syncColorPicker('custom_accent_color', 'custom_accent_color_text');

    // Mark initially selected theme card
    const selectedTheme = document.querySelector('input[name="selected_theme"]:checked');
    if (selectedTheme) {
        selectedTheme.closest('.theme-preview').classList.add('border-primary');
    }

    // Gallery mode radio button functionality
    const galleryRadios = document.querySelectorAll('input[name="gallery_mode"]');
    galleryRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            updateGalleryModeDisplay();
        });
    });

    // Initial gallery mode display
    updateGalleryModeDisplay();
});

// Gallery mode selection function
function selectGalleryMode(mode) {
    const radio = document.getElementById('gallery_' + mode);
    radio.checked = true;
    updateGalleryModeDisplay();
}

// Update gallery mode display
function updateGalleryModeDisplay() {
    const staticRadio = document.getElementById('gallery_static');
    const carouselRadio = document.getElementById('gallery_carousel');
    const staticUsage = document.getElementById('gallery-usage-static');
    const carouselUsage = document.getElementById('gallery-usage-carousel');

    // Update visual feedback
    document.querySelectorAll('.theme-preview').forEach(preview => {
        if (preview.querySelector('input[name="gallery_mode"]')) {
            preview.classList.remove('border-primary');
        }
    });

    if (staticRadio.checked) {
        staticRadio.closest('.theme-preview').classList.add('border-primary');
        staticUsage.style.display = 'block';
        carouselUsage.style.display = 'none';
    } else if (carouselRadio.checked) {
        carouselRadio.closest('.theme-preview').classList.add('border-primary');
        staticUsage.style.display = 'none';
        carouselUsage.style.display = 'block';
    }
}
</script>
{% endblock %}